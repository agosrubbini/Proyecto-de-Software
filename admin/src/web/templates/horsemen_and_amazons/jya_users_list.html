{% extends "layout.html" %}

{% block title %}Listado de jinetes y amazonas{% endblock %}
{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/horsemen_and_amazons/jya_list.css') }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/horsemen_and_amazons/jya_info.css') }}"/>
{% endblock %}

{% block content %}

    <div class="encabezado">
        <h1>Listado de Jinetes y Amazonas</h1>
    </div>
    <hr class="separador">

    <form id="form-search" method="GET" action="{{url_for('horsemen_and_amazons.list_jya_users')}}">
        <div class="field is-grouped">
            <div class="field">
                <label class="label">Nombre</label>
                <div class="control has-icons-left">
                    <span class="icon is-small is-left">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </span>
                    <input class="input" type="text" name="name" placeholder="Nombre del jinete" value="{{ name }}" />
                </div>
            </div>
            <div class="field">
                <label class="label">Apellido</label>
                <div class="control has-icons-left">
                    <span class="icon is-small is-left">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </span>
                    <input class="input" type="text" name="last_name" placeholder="Apellido del jinete" value="{{ last_name }}" />
                </div>
            </div>
            <div class="field">
                <label class="label">DNI</label>
                <div class="control has-icons-left">
                    <span class="icon is-small is-left">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </span>
                    <input class="input" type="text" name="dni" placeholder="DNI del jinete" value="{{ dni }}" />
                </div>
            </div>
            <div class="field">
                <label class="label">Profesionales</label>
                <div class="control has-icons-left">
                    <span class="icon is-small is-left">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </span>
                    <input class="input" type="text" name="professionals" placeholder="Profesionales" value="{{ professionals }}" />
                </div>
            </div>
            <div class="field">
                <div class="control">
                    <button class="boton filter field is-fullwidth" type="submit">Buscar</button>
                </div>
            </div>
        </div>
    </form>    
    <form method="GET" action="{{ url_for('horsemen_and_amazons.list_jya_users') }}">
        <div class="control order_options">
            <select id="order_option" name="order_option" onchange="this.form.submit()">
                <option value="default">Selecciona un orden</option>
                <option value="name_asc">Nombre: A-Z</option>
                <option value="name_desc">Nombre: Z-A</option>
                <option value="last_name_asc">Apellido: Menor-Mayor</option>
                <option value="last_name_desc">Apellido: Mayor-Menor</option>
            </select>
        </div>
    </form>

    <div class="table-container">
        <table class="table is-striped users">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>DNI</th>
                    <th>Edad</th>
                    <th>Operaciones</th>
                </tr>
            </thead>
            <tbody>
                {% if users %}
                    {% for user in users %}
                            <tr onclick="window.location.href='{{ url_for('horsemen_and_amazons.list_info_by_jya', user_id=user.id) }}'">
                                <td> {{user.name}} </td>
                                <td> {{user.last_name}} </td>
                                <td> {{user.DNI}} </td>
                                <td> {{user.age}} </td>
                                <td>
                                    <select class="operations" data-user-id="{{ user.id }}" onclick="event.stopPropagation();">
                                        <option value="default">Selecciona la operaci√≥n</option>
                                        <option value="edit">Editar</option>
                                        <option value="delete">Eliminar</option>
                                    </select>
                                </td>
                            </tr>
                    {% endfor %}
                {% else %}
                    <p style="text-align: center;">No hay jinetes registrados en el sistema</p>
                {% endif %}
            </tbody>
        </table>
        
        <a href="{{ url_for('horsemen_and_amazons.add_horseman') }}"><button class="boton add-horseman">Registrar jinete</button></a>

    </div>


<script>
        document.addEventListener('DOMContentLoaded', function () {
            const tabla = document.querySelector('.table');
            const boton = document.querySelector('.add-horseman');

            const anchoTabla = tabla.offsetWidth;

            boton.style.width = anchoTabla + 'px';

            // Manejo de cambios en las operaciones
            document.addEventListener('change', (e) => {
                if (e.target.classList.contains('operations')) {
                    const selectedValue = e.target.value;
                    
                    const userId = e.target.dataset.userId;

                    console.log(userId);
                    
                    if (selectedValue === 'delete'){
                        const deleteUrl = "{{ url_for('horsemen_and_amazons.delete_horseman', user_id=0) }}".replace('/0', `/${userId}`);
                        window.location.href = deleteUrl;
                    }

                    if (selectedValue === 'edit'){
                        const editUrl = "{{ url_for('horsemen_and_amazons.edit_horseman', user_id=0) }}".replace('/0', `/${userId}`);
                        window.location.href = editUrl;
                    }
                }
            });
    });

</script>
{% endblock %}