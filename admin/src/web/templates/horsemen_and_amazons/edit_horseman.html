{% extends "layout.html" %}

{% block title %}Editar Jinete{% endblock %}


{% block head %}
    {{ super() }}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/horsemen_and_amazons/forms.css') }}">
{% endblock %}

{% block content %}

<form method="POST" action="{{ url_for('horsemen_and_amazons.edit_horseman', user_id=user_id) }}">
    
    {{ form.csrf_token }}
    {{ form.new_address.csrf_token }}
    {{ form.new_emergency_contact.csrf_token }}
    {{ form.healthcare_plan.csrf_token }}
    {{ form.school.csrf_token }}
    {{ form.school.address_school_id.csrf_token }}

    <div class="div-titulo">
        <h1 class="label">Editar Jinete</h1>
        <hr class="linea-titulo">
    </div>

    <label class="label">Nombre</label>
    <div class="control has-icons-left">
        <span class="icon is-small is-left">
            <i class="fas fa-user"></i>
        </span>
        {{ form.name(class="input", placeholder="Ingrese el nombre del jinete", value=horseman.name, required=True) }}
    </div>
    <hr>

    <label class="label">Apellido</label>
    <div class="control has-icons-left">
        <span class="icon is-small is-left">
            <i class="fas fa-user-tag"></i>
        </span>
        {{ form.last_name(class="input", placeholder="Ingrese el apellido del jinete", value=horseman.last_name , required=True) }}
    </div>
    <hr>

    <label class="label">DNI (sin puntos) </label>
    <div class="control has-icons-left">
        <span class="icon is-small is-left">
            <i class="fas fa-id-card"></i>
        </span>
        {{ form.DNI(class="input", placeholder="Ingrese el dni del jinete", value=horseman.DNI, maxlength=9, required=True) }}
    </div>
    <hr>

    <label class="label">Edad</label>
    <div class="control has-icons-left">
        <span class="icon is-small is-left">
            <i class="fas fa-calendar"></i>
        </span>
        {{ form.age(class="input", placeholder="Ingrese la edad del jinete", value=horseman.age, required=True) }}
    </div>
    <hr>

    <label class="label">Número de teléfono</label>
    <div class="control has-icons-left">
        <span class="icon is-small is-left">
            <i class="fa-solid fa-phone"></i>
        </span>
        {{ form.phone_number(class="input", placeholder="Ingrese el teléfono del jinete", value=horseman.phone_number, required=True) }}
    </div>
    <hr>

    <label class="label" for="address-street">Dirección del jinete</label>
    <hr>

        <label class="label" for="address-street">Calle</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-road"></i>
            </span>
            <input class="input" type="text" name="address-street" id="address-street" value="{{ address.street }}">
        </div>
        <label class="label " for="address-number">Numero</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-hashtag"></i>
            </span>
            <input class="input " type="text" name="address-number" id="address-number" value="{{ address.number }}">
        </div>
        <label class="label" for="address-department">Piso</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-building"></i>
            </span>
            <input class="input " type="text" name="address-department" id="address-department" value="{{ address.department }}">
        </div>
        <label class="label" for="address-locality">Localidad</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-city"></i>
            </span>
            <input class="input" type="text" name="address-locality" id="address-locality" value="{{ address.locality }}">
        </div>
        <label class="label" for="address-province">Provincia</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-map"></i>
            </span>
            <input class="input" type="text" name="address-province" id="address-province" value="{{ address.province }}">
        </div>
        <label class="label" for="address-phone_number">Telefono</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-phone"></i>
            </span>
            <input class="input " type="text" name="address-phone_number" id="address-phone_number" value="{{ address.phone_number}}">
        </div>


    <label class="label">Fecha de nacimiento</label>
    <div class="control has-icons-left">
        {{ form.birthdate(class="input_fecha", value=horseman.birthdate, required=True) }}
    </div>
    <hr>

    <label class="label">Lugar de nacimiento</label>
    <div class="control has-icons-left">
        <span class="icon is-small is-left">
            <i class="fas fa-map-marker-alt"></i>
        </span>
        {{ form.birth_place(class="input", required=True, value=horseman.birth_place, placeholder="Ingrese el lugar de nacimiento del jinete") }}
    </div>
    <hr>

    <label class="label">Teléfono actual</label>
    <div class="control has-icons-left">
        <span class="icon is-small is-left">
            <i class="fa-solid fa-phone"></i>
        </span>
        {{ form.current_phone(class="input", required=True, value=horseman.current_phone, placeholder="Ingrese el teléfono actual del jinete") }}
    </div>
    <hr>

    <label class="label" for="emergency_contact-name">Nombre</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-user"></i>
            </span>
            <input class="input" type="text" name="emergency_contact-name" id="emergency_contact-name" value="{{ emergency_contact.name }}">
        </div>
        <label class="label" for="emergency_contact-phone_number">Numero</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-phone"></i>
            </span>
            <input class="input" type="text" name="emergency_contact-phone_number" id="emergency_contact-phone_number" value="{{ emergency_contact.phone_number }}">
        </div>
    

    <div class="custom-checkbox">
        <input type="checkbox" id="checkbox-beca" name="is_scholarshipped" value="True" {% if horseman.is_scholarshipped %}checked{% endif %}>
        <label class="label" for="checkbox-beca">¿Está becado?</label>
    </div>
    <hr>

    <div id="contenedor-beca" class="hidden">
        <label class="label">Porcentaje de la beca</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-percent"></i>
            </span>
            {{ form.scholarship_percentage(class="input", value=horseman.scholarship_percentage if not None else "", placeholder="Ingrese el porcentaje de la beca") }}
        </div>
    </div>

    <label class="label">Profesionales que lo atienden</label>
    <div class="control has-icons-left">
        <span class="icon is-small is-left">
            <i class="fas fa-user-md"></i>
        </span>
        {{ form.attending_professionals(class="input", required=True, value=horseman.attending_professionals, placeholder="Ingreso los profesionales que lo atienden") }}
    </div>

    <label class="label healthcare_plan_social_security" for="healthcare_plan_social_security">Nombre de la obra social</label>
    <div class="control has-icons-left">
        <span class="icon is-small is-left">
            <i class="fas fa-hospital-alt"></i>
        </span>
        <input class="input healthcare_plan-social_security" type="text" name="healthcare_plan-social_security" id="healthcare_plan-social_security" value="{{ healthcare_plan.social_security}}">
    </div>
    <hr>

    <label class="label healthcare_plan_affiliate_number" for="healthcare_plan-affiliate_number">Numero de afiliado</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-id-card"></i>
            </span>
            <input class="input healthcare_plan-affiliate_number" type="text" name="healthcare_plan-affiliate_number" id="healthcare_plan-affiliate_number" value="{{ healthcare_plan.affiliate_number}}">
        </div>
    <hr>
    
    <div class="custom-checkbox">
        <input type="checkbox" name="healthcare_plan-has_guardianship" id="healthcare_plan-has_guardianship"  value="True" {% if healthcare_plan.has_guardianship %}checked{% endif %}>
        <label class="label" for="healthcare_plan-has_guardianship">¿Tiene tutela?</label>
    </div>
    <hr>

    <label class="label healthcare_plan_observation" for="healthcare_plan-observation">Observaciones</label>
    <input class="input healthcare_plan-observation" type="textarea" name="healthcare_plan-observation" id="healthcare_plan-observation" value="{{ healthcare_plan.observation}}">
    <hr>

    <div class="custom-checkbox">
        <input type="checkbox" id="checkbox-discapacidad" name="has_disability_certificate" value="True" {% if horseman.has_disability_certificate %}checked{% endif %}>
        <label class="label" for="checkbox-discapacidad">¿Posee certificado de discapacidad?</label>
    </div>
    <hr>
    
    <div id="contenedor-cerficado-discapacidad" class="hidden">
        <label class="label">¿Con qué diagnóstico?</label>
        <select name="diagnosis">
            {% for value, label in form.diagnosis.choices %}
                <option value="{{ value }}" {% if horseman.diagnosis == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <hr>
        
        <label class="label">Si es otro, indicar cuál:</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-notes-medical"></i>
            </span>
            {{ form.other_diagnosis(class="input", value=horseman.other_diagnosis) }}
        </div>
        <hr>

        <label class="label">Tipo de discapacidad</label>
            <select name="type_of_disability">
                {% for value, label in form.type_of_disability.choices %}
                    <option value="{{ value }}" {% if horseman.type_of_disability == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        <hr>
    </div>


    <div class="custom-checkbox">
        <input type="checkbox" id="checkbox-asignacion" name="receives_family_allowance" value="True" {% if horseman.receives_family_allowance %}checked{% endif %}>
        <label class="label" for="checkbox-asignacion">¿Percibe alguna Asignación Familiar?</label>
    </div>
    <hr>
    

    <div id="contenedor-asignacion" class="hidden">
        <label class="label">¿Cuál?</label>
        <select name="family_allowance">
            {% for value, label in form.family_allowance.choices %}
                <option value="{{ value }}" {% if horseman.family_allowance == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <hr>
    </div>

    
    <div class="custom-checkbox">
        <input type="checkbox" id="checkbox-pension" name="is_beneficiary_of_pension" value="True" {% if horseman.is_beneficiary_of_pension %}checked{% endif %}>
        <label class="label" for="checkbox-pension">¿Es beneficiario de alguna pensión?</label>
    </div>
    <hr>
    

    <div id="contenedor-pension" class="hidden">
        <label class="label">Pensión</label>
        <select name="pension">
            {% for value, label in form.pension.choices %}
                <option value="{{ value }}" {% if horseman.pension == value %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <hr>
    </div>

    
    <div class="custom-checkbox">
        <input type="checkbox" id="checkbox-escuela" name="attends_school" value="True" {% if horseman.attends_school %}checked{% endif %}>
        <label class="label" for="checkbox-escuela">¿Asiste a la escuela?</label>
    </div>
    <hr>
    

    <div id="contenedor-escuela" class="hidden">
        <label class="label">Nombre de la escuela</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-school"></i>
            </span>
            <input class="input" type="text" name="school-name_school" id="school-name_school" value="{{ school.name }}">
        </div>
        <hr>

        <label class="label" for="address_school-street">Calle de la escuela</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-road"></i>
            </span>
            <input class="input" type="text" name="school-address_school_id-street" id="address_school_id-street" value="{{ address_school.street }}">
        </div>
        <label class="label" for="address_school-number">Número del edificio de la escuela</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-hashtag"></i>
            </span>
            <input class="input" type="text" name="school-address_school_id--number" id="address_school-number" value="{{ address_school.number }}">
        </div>
        <label class="label" for="address_school-department">Piso de la escuela</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-building"></i>
            </span>
            <input class="input" type="text" name="school-address_school_id--department" id="address_school-department" value="{{ address_school.department }}">
        </div>
        <label class="label" for="address_school-locality">Localidad donde se encuentra la escuela</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-city"></i>
            </span>
            <input class="input" type="text" name="school-address_school_id--locality" id="address_school-locality" value="{{ address_school.locality }}">
        </div>
        <label class="label" for="address_school-province">Provincia donde se encuentra la escuela</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-map"></i>
            </span>
            <input class="input" type="text" name="school-address_school_id--province" id="address_school-province" value="{{ address_school.province }}">
        </div>
    
        <label class="label" for="address_school-phone_number">Teléfono de la escuela</label>
        <div class="control has-icons-left">
            <span class="icon is-small is-left">
                <i class="fas fa-phone"></i>
            </span>
            <input class="input" type="text" name="school-phone_number" id="school-phone_number" value="{{ school.phone_number }}">
        </div>
        <hr>

        <label class="label">Año actual que está cursando</label>
            <select name="school-current_year" id="school-current_year" value="{{ form.school.current_year.data or '' }}">
                {% for year in form.school.current_year.choices %}
                    <option value="{{ year }}"{% if school.current_year == value %}selected{% endif%}>{{ year }}</option>
                {% endfor %}
            </select>
        <hr>

        <label class="label">Observaciones</label>
        <input class="input" type="text" name="school-observation" id="school-observation" value="{{ school.observation or ''}}">
        <hr>
    </div>

    <div class="buttons">
        <button type="submit">Editar Jinete</button>
        <a href="{{ url_for('horsemen_and_amazons.list_jya_users') }}"><button type="button" class="boton-cancelar">Cancelar</button></a>
    </div>

</form>


<script>
        document.addEventListener('DOMContentLoaded', () => {

            // Mapeo de IDs de checkboxes a los contenedores que mostrarán los campos adicionales
            const checkboxMap = {
                'checkbox-beca': 'contenedor-beca',
                'checkbox-discapacidad': 'contenedor-cerficado-discapacidad',
                'checkbox-asignacion': 'contenedor-asignacion',
                'checkbox-pension': 'contenedor-pension',
                'checkbox-escuela': 'contenedor-escuela',
            };

            // Función para manejar el cambio en los checkboxes
            const handleCheckboxChange = (checkboxId, containerId) => {
                const checkbox = document.getElementById(checkboxId);
                const contenedor = document.getElementById(containerId);

                print(checkbox);
                print(checkbox.checked);

                if (checkbox.checked) {
                    contenedor.classList.remove('hidden');
                } else {
                    contenedor.classList.add('hidden');
                }

                checkbox.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        contenedor.classList.remove('hidden');
                    } else {
                        contenedor.classList.add('hidden');
                    }
                });
            };

            // Recorremos el mapeo para agregar el listener a cada checkbox
            Object.keys(checkboxMap).forEach(checkboxId => {
                    handleCheckboxChange(checkboxId, checkboxMap[checkboxId]);
            });
    });
</script>
{% endblock %}